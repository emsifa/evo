"use strict";(self.webpackChunkevo=self.webpackChunkevo||[]).push([[179],{3905:function(e,n,t){t.d(n,{Zo:function(){return u},kt:function(){return m}});var o=t(7294);function s(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function p(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){s(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function r(e,n){if(null==e)return{};var t,o,s=function(e,n){if(null==e)return{};var t,o,s={},a=Object.keys(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||(s[t]=e[t]);return s}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}var i=o.createContext({}),l=function(e){var n=o.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):p(p({},n),e)),t},u=function(e){var n=l(e.components);return o.createElement(i.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},c=o.forwardRef((function(e,n){var t=e.components,s=e.mdxType,a=e.originalType,i=e.parentName,u=r(e,["components","mdxType","originalType","parentName"]),c=l(t),m=s,k=c["".concat(i,".").concat(m)]||c[m]||d[m]||a;return t?o.createElement(k,p(p({ref:n},u),{},{components:t})):o.createElement(k,p({ref:n},u))}));function m(e,n){var t=arguments,s=n&&n.mdxType;if("string"==typeof e||s){var a=t.length,p=new Array(a);p[0]=c;var r={};for(var i in n)hasOwnProperty.call(n,i)&&(r[i]=n[i]);r.originalType=e,r.mdxType="string"==typeof e?e:s,p[1]=r;for(var l=2;l<a;l++)p[l]=t[l];return o.createElement.apply(null,p)}return o.createElement.apply(null,t)}c.displayName="MDXCreateElement"},5959:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return r},contentTitle:function(){return i},metadata:function(){return l},toc:function(){return u},default:function(){return c}});var o=t(7462),s=t(3366),a=(t(7294),t(3905)),p=["components"],r={sidebar_position:6},i="Response",l={unversionedId:"response",id:"response",isDocsHomePage:!1,title:"Response",description:"Evo provide custom response class Emsifa\\Evo\\Http\\Response\\JsonResponse and Emsifa\\Evo\\Http\\Response\\ViewResponse that is inherit from Emsifa\\Evo\\Dto class.",source:"@site/docs/response.md",sourceDirName:".",slug:"/response",permalink:"/evo/docs/response",editUrl:"https://github.com/emsifa/evo/edit/main/website/docs/response.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"Validation",permalink:"/evo/docs/validation"},next:{title:"Swagger UI",permalink:"/evo/docs/swagger-ui"}},u=[{value:"Generate Response Class",id:"generate-response-class",children:[]},{value:"Using Response Class",id:"using-response-class",children:[]},{value:"Using View Response",id:"using-view-response",children:[]},{value:"Define Response Status",id:"define-response-status",children:[]},{value:"Using Json Template",id:"using-json-template",children:[]}],d={toc:u};function c(e){var n=e.components,t=(0,s.Z)(e,p);return(0,a.kt)("wrapper",(0,o.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"response"},"Response"),(0,a.kt)("p",null,"Evo provide custom response class ",(0,a.kt)("inlineCode",{parentName:"p"},"Emsifa\\Evo\\Http\\Response\\JsonResponse")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"Emsifa\\Evo\\Http\\Response\\ViewResponse")," that is inherit from ",(0,a.kt)("inlineCode",{parentName:"p"},"Emsifa\\Evo\\Dto")," class.\nThey are all implements ",(0,a.kt)("inlineCode",{parentName:"p"},"Illuminate\\Contracts\\Support\\Responsable"),", so that they can be transformed to HTTP response."),(0,a.kt)("p",null,"You can extend them to your response classes then use your response classes as return type of your controller action to get these benefits below:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Easier to identify how the response data should be."),(0,a.kt)("li",{parentName:"ul"},"It prevents you to send wrong data types. Eg: integer as string, null to non-nullable property, etc."),(0,a.kt)("li",{parentName:"ul"},"It makes Evo knows how to generate your endpoint into OpenAPI."),(0,a.kt)("li",{parentName:"ul"},"It makes Evo knows how to mock the response.")),(0,a.kt)("h2",{id:"generate-response-class"},"Generate Response Class"),(0,a.kt)("p",null,"Evo provide ",(0,a.kt)("inlineCode",{parentName:"p"},"evo:make-response")," command to generate response class. Here is its command signature:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"php artisan evo:make-response {classname} {...properties} {--view} {--json-template=} \n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"classname")," (required): class name to be generated."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"properties")," (optional): class properties."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--view")," (optional): by default ",(0,a.kt)("inlineCode",{parentName:"li"},"evo:make-response")," command will use ",(0,a.kt)("inlineCode",{parentName:"li"},"JsonResponse")," as parent class, if you want to use ",(0,a.kt)("inlineCode",{parentName:"li"},"ViewResponse"),", you can add this option."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--json-template="),": add this if you want to apply ",(0,a.kt)("inlineCode",{parentName:"li"},"UseJsonTemplate")," attribute in generated response class.")),(0,a.kt)("p",null,"For example, we will generate ",(0,a.kt)("inlineCode",{parentName:"p"},"StoreTodoResponse")," with command below:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"php artisan evo:make-response StoreTodoResponse id:int title:string completed:bool\n")),(0,a.kt)("p",null,"It will generate ",(0,a.kt)("inlineCode",{parentName:"p"},"app/Http/Responses/StoreTodoResponse")," class with following code below:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n\nnamespace App\\Http\\Responses;\n\nuse Emsifa\\Evo\\Http\\Response\\JsonResponse;\n\nclass StoreTodoResponse extends JsonResponse\n{\n    public int $id;\n    public string $title;\n    public bool $completed;\n}\n")),(0,a.kt)("h2",{id:"using-response-class"},"Using Response Class"),(0,a.kt)("p",null,"To use ",(0,a.kt)("inlineCode",{parentName:"p"},"StoreTodoResponse")," you need to put it as return type, then in your controller you can use ",(0,a.kt)("inlineCode",{parentName:"p"},"fromArray")," method like an example below:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},"#[Post]\npublic function store(#[Body] StoreTodoDto $dto): StoreTodoResponse\n{\n    $todo = Todo::create($dto);\n\n    return StoreTodoResponse::fromArray($todo);\n}\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"StoreTodoResponse::fromArray")," method will create ",(0,a.kt)("inlineCode",{parentName:"p"},"StoreTodoResponse")," instance by mapping ",(0,a.kt)("inlineCode",{parentName:"p"},"StoreTodoResponse")," public properties with ",(0,a.kt)("inlineCode",{parentName:"p"},"$todo")," array values. It also apply type casting for each properties."),(0,a.kt)("h2",{id:"using-view-response"},"Using View Response"),(0,a.kt)("p",null,"In this example we will create view response in Evo's way."),(0,a.kt)("p",null,"First let's generate our response view with following command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"php artisan evo:make-response EditTodoResponse todo:TodoDto --view\n")),(0,a.kt)("p",null,"Since you put ",(0,a.kt)("inlineCode",{parentName:"p"},"TodoDto")," type there, it will generate 2 files below:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"app/Http/Responses/EditTodoResponse"),":"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n\nnamespace App\\Http\\Responses;\n\nuse Emsifa\\Evo\\Http\\Response\\UseView;\nuse Emsifa\\Evo\\Http\\Response\\ViewResponse;\n\n#[UseView('edit-todo')]\nclass EditTodoResponse extends ViewResponse\n{\n    public TodoDto $todo;\n}\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"app/Http/Responses/TodoDto"),":"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n\nnamespace App\\Http\\Responses;\n\nuse Emsifa\\Evo\\Http\\Response\\ResponseDto;\n\nclass TodoDto extends ResponseDto\n{\n}\n")))),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"UseView")," attribute above is used to identify what view file should be rendered, and the data passed to the view is its properties, in this case ",(0,a.kt)("inlineCode",{parentName:"p"},"$todo")," that is ",(0,a.kt)("inlineCode",{parentName:"p"},"TodoDto")," instance."),(0,a.kt)("p",null,"Now, let's edit ",(0,a.kt)("inlineCode",{parentName:"p"},"TodoDTO")," with following properties:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n\nnamespace App\\Http\\Responses;\n\nuse DateTime;\nuse Emsifa\\Evo\\Http\\Response\\ResponseDTO;\n\nclass TodoDTO extends ResponseDTO\n{\n    public int $id;\n    public string $title;\n    public bool $is_completed;\n    public DateTime $created_at;\n    public ?DateTime $updated_at;\n}\n")),(0,a.kt)("p",null,"And here is the example on how to use ",(0,a.kt)("inlineCode",{parentName:"p"},"EditTodoResponse")," view:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},"#[Get('{id}')]\npublic function edit(#[Param] int $id): EditTodoResponse\n{\n    $todo = Todo::findOrFail($id);\n\n    return EditTodoResponse::fromArray(['todo' => $todo]);\n}\n")),(0,a.kt)("p",null,"Yes, Evo will automatically transform your ",(0,a.kt)("inlineCode",{parentName:"p"},"Todo")," model into ",(0,a.kt)("inlineCode",{parentName:"p"},"TodoDto")," instance."),(0,a.kt)("h2",{id:"define-response-status"},"Define Response Status"),(0,a.kt)("p",null,"To define response status in your response class, you can attach ",(0,a.kt)("inlineCode",{parentName:"p"},"Emsifa\\Evo\\Http\\Response\\ResponseStatus")," attribute in your response class like following code below:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n\nnamespace App\\Http\\Responses;\n\nuse Emsifa\\Evo\\Http\\Response\\JsonResponse;\nuse Emsifa\\Evo\\Http\\Response\\ResponseStatus;\n\n#[ResponseStatus(201)]\nclass StoreTodoResponse extends JsonResponse\n{\n    public int $id;\n    public string $title;\n    public bool $completed;\n}\n")),(0,a.kt)("p",null,"Now, when you return ",(0,a.kt)("inlineCode",{parentName:"p"},"StoreTodoResponse"),", Evo will set response status to ",(0,a.kt)("inlineCode",{parentName:"p"},"201"),"."),(0,a.kt)("h2",{id:"using-json-template"},"Using Json Template"),(0,a.kt)("p",null,"Evo provide ",(0,a.kt)("inlineCode",{parentName:"p"},"Emsifa\\Evo\\Contracts\\JsonTemplate")," class to wrap your ",(0,a.kt)("inlineCode",{parentName:"p"},"JsonResponse")," instance."),(0,a.kt)("p",null,"When building RESTful API you may have a convention/standard on how your data formatted."),(0,a.kt)("p",null,"For example we want our ",(0,a.kt)("inlineCode",{parentName:"p"},"StoreTodoResponse")," instead of just rendered like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "id": 1,\n    "title": "Write documentation",\n    "completed": false\n}\n')),(0,a.kt)("p",null,"We want it to be wrapped like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "status": "ok",\n    "data": {\n        "id": 1,\n        "title": "Write documentation",\n        "completed": false\n    }\n}\n')),(0,a.kt)("p",null,"To do this, we have to create a class that implements ",(0,a.kt)("inlineCode",{parentName:"p"},"Emsifa\\Evo\\Contracts\\JsonTemplate"),".\nThis class will be used as a wrapper to all of your JSON response classes."),(0,a.kt)("p",null,"Let's create file ",(0,a.kt)("inlineCode",{parentName:"p"},"app/Http/Responses/SuccessJsonTemplate.php")," with following code:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},'<?php\n\nnamespace App\\Http\\Responses;\n\nuse Emsifa\\Evo\\Contracts\\JsonData;\nuse Emsifa\\Evo\\Contracts\\JsonTemplate;\nuse Emsifa\\Evo\\Http\\Response\\JsonResponse;\n\nclass SuccessJsonTemplate implements JsonTemplate\n{\n    public string $status;\n    public JsonData $data;\n\n    /**\n     * @param BaseResponse $response\n     */\n    public function forJsonResponse(JsonResponse $response): static\n    {\n        $this->status = "ok";\n        $this->data = $response->getData();\n\n        return $this;\n    }\n}\n')),(0,a.kt)("p",null,"Now you can use this template using ",(0,a.kt)("inlineCode",{parentName:"p"},"Emsifa\\Evo\\Http\\Response\\UseJsonTemplate")," like following code below:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php",metastring:"{6,8}","{6,8}":!0},"<?php\n\nnamespace App\\Http\\Responses;\n\nuse Emsifa\\Evo\\Http\\Response\\JsonResponse;\nuse Emsifa\\Evo\\Http\\Response\\UseJsonTemplate;\n\n#[UseJsonTemplate(SuccessJsonTemplate::class)]\nclass StoreTodoResponse extends JsonResponse\n{\n    public int $id;\n    public string $title;\n    public bool $completed;\n}\n")),(0,a.kt)("p",null,"Now whenever you return ",(0,a.kt)("inlineCode",{parentName:"p"},"StoreTodoResponse")," in your controller, it will be wrapped with ",(0,a.kt)("inlineCode",{parentName:"p"},"SuccessJsonTemplate")," data."))}c.isMDXComponent=!0}}]);