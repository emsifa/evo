"use strict";(self.webpackChunkevo=self.webpackChunkevo||[]).push([[886],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var u=a.createContext({}),s=function(e){var t=a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=s(e.components);return a.createElement(u.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,u=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),c=s(n),m=r,k=c["".concat(u,".").concat(m)]||c[m]||d[m]||i;return n?a.createElement(k,o(o({ref:t},p),{},{components:n})):a.createElement(k,o({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=c;var l={};for(var u in t)hasOwnProperty.call(t,u)&&(l[u]=t[u]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var s=2;s<i;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},1262:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return u},metadata:function(){return s},toc:function(){return p},default:function(){return c}});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),o=["components"],l={sidebar_position:3},u="Request",s={unversionedId:"request",id:"request",isDocsHomePage:!1,title:"Request",description:"In Evo, you can access request value by attaching request attributes such as Query, Cookie, Header, Param, Body, etc to your method parameters. Then Evo will automatically inject corresponding value to attached parameter. Evo will also automatically validate and cast the value according to parameter type and definition.",source:"@site/docs/request.md",sourceDirName:".",slug:"/request",permalink:"/evo/docs/request",editUrl:"https://github.com/emsifa/evo/edit/main/website/docs/request.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Routing",permalink:"/evo/docs/routing"},next:{title:"DTO",permalink:"/evo/docs/dto"}},p=[{value:"<code>Query</code> Attribute",id:"query-attribute",children:[]},{value:"<code>Param</code> Attribute",id:"param-attribute",children:[]},{value:"<code>Header</code> Attribute",id:"header-attribute",children:[]},{value:"<code>Cookie</code> Attribute",id:"cookie-attribute",children:[]},{value:"<code>Body</code> Attribute",id:"body-attribute",children:[]},{value:"Uploaded File",id:"uploaded-file",children:[{value:"1. Getting uploaded file using DTO and <code>Body</code> attribute",id:"1-getting-uploaded-file-using-dto-and-body-attribute",children:[]},{value:"2. Getting uploaded file using <code>File</code> attribute",id:"2-getting-uploaded-file-using-file-attribute",children:[]}]},{value:"<code>LoggedUser</code> Attribute",id:"loggeduser-attribute",children:[]},{value:"Create Custom Request Attribute",id:"create-custom-request-attribute",children:[]}],d={toc:p};function c(e){var t=e.components,n=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"request"},"Request"),(0,i.kt)("p",null,"In Evo, you can access request value by attaching request attributes such as ",(0,i.kt)("inlineCode",{parentName:"p"},"Query"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"Cookie"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"Header"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"Param"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"Body"),", etc to your method parameters. Then Evo will automatically inject corresponding value to attached parameter. Evo will also automatically validate and cast the value according to parameter type and definition."),(0,i.kt)("p",null,"Before using those attributes, make sure you have import their full class names."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"use Emsifa\\Evo\\Http\\Param;\nuse Emsifa\\Evo\\Http\\Query;\nuse Emsifa\\Evo\\Http\\Header;\nuse Emsifa\\Evo\\Http\\Cookie;\nuse Emsifa\\Evo\\Http\\Body;\n")),(0,i.kt)("h2",{id:"query-attribute"},(0,i.kt)("inlineCode",{parentName:"h2"},"Query")," Attribute"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Query")," attribute is used to get a query value from HTTP request."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php",metastring:"{2}","{2}":!0},"#[Get]\npublic function index(#[Query] int $page)\n{\n    // ...\n} \n")),(0,i.kt)("p",null,"In example above, Evo will:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Getting ",(0,i.kt)("inlineCode",{parentName:"li"},"request()->query('page')")," value."),(0,i.kt)("li",{parentName:"ol"},"Apply validation to the value to make sure it's numeric."),(0,i.kt)("li",{parentName:"ol"},"Cast value to ",(0,i.kt)("inlineCode",{parentName:"li"},"int"),"."),(0,i.kt)("li",{parentName:"ol"},"Inject casted value to ",(0,i.kt)("inlineCode",{parentName:"li"},"$page")," parameter.")),(0,i.kt)("p",null,"If you want to use different query and parameter name, you can set ",(0,i.kt)("inlineCode",{parentName:"p"},"$key")," parameter to ",(0,i.kt)("inlineCode",{parentName:"p"},"Query")," attribute like an example below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php",metastring:"{2}","{2}":!0},"#[Get]\npublic function index(#[Query('p')] int $page)\n{\n    // ...\n} \n")),(0,i.kt)("p",null,"In example above Evo will get ",(0,i.kt)("inlineCode",{parentName:"p"},"p")," query value and inject it to ",(0,i.kt)("inlineCode",{parentName:"p"},"$page")," parameter."),(0,i.kt)("p",null,"If you want to make it optional, you can just give default value to the parameter. For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php",metastring:"{2}","{2}":!0},"#[Get]\npublic function index(#[Query('q')] int $page = 1)\n{\n    // ...\n} \n")),(0,i.kt)("p",null,"Or you can also make it nullable, for example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php",metastring:"{2}","{2}":!0},"#[Get]\npublic function index(#[Query('q')] ?int $page)\n{\n    // ...\n}\n")),(0,i.kt)("h2",{id:"param-attribute"},(0,i.kt)("inlineCode",{parentName:"h2"},"Param")," Attribute"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Param")," attribute is used to get URI parameter value."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php",metastring:"{2}","{2}":!0},"#[Get('users/{id}')]\npublic function index(#[Param] int $id)\n{\n    // ...\n} \n")),(0,i.kt)("p",null,"Like ",(0,i.kt)("inlineCode",{parentName:"p"},"Query")," attribute before, Evo will do validation, type casting, and inject the value to the ",(0,i.kt)("inlineCode",{parentName:"p"},"$id")," parameter. "),(0,i.kt)("h2",{id:"header-attribute"},(0,i.kt)("inlineCode",{parentName:"h2"},"Header")," Attribute"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Header")," attribute is used to get a header value from HTTP request."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php",metastring:"{2}","{2}":!0},"#[Get('users/{id}')]\npublic function index(#[Header('user-agent')] string $userAgent)\n{\n    // ...\n} \n")),(0,i.kt)("p",null,"In example above, Evo will get ",(0,i.kt)("inlineCode",{parentName:"p"},"user-agent")," header value and inject it to the ",(0,i.kt)("inlineCode",{parentName:"p"},"$userAgent")," parameter."),(0,i.kt)("h2",{id:"cookie-attribute"},(0,i.kt)("inlineCode",{parentName:"h2"},"Cookie")," Attribute"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Cookie")," attribute is used to get a cookie value from HTTP request."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php",metastring:"{2}","{2}":!0},"#[Get('users/{id}')]\npublic function index(#[Cookie] string $token)\n{\n    // ...\n} \n")),(0,i.kt)("p",null,"In example above, Evo will get ",(0,i.kt)("inlineCode",{parentName:"p"},"token")," cookie value and inject it to the ",(0,i.kt)("inlineCode",{parentName:"p"},"$token")," parameter."),(0,i.kt)("h2",{id:"body-attribute"},(0,i.kt)("inlineCode",{parentName:"h2"},"Body")," Attribute"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Body")," attribute is used to get value from HTTP request body.\nTo use ",(0,i.kt)("inlineCode",{parentName:"p"},"Body")," attribute you have to use ",(0,i.kt)("inlineCode",{parentName:"p"},"DTO")," class as the type of your parameter.\nYou can create ",(0,i.kt)("inlineCode",{parentName:"p"},"DTO")," class by using ",(0,i.kt)("inlineCode",{parentName:"p"},"evo:make-dto")," command."),(0,i.kt)("p",null,"In this example, we will inject request body value as ",(0,i.kt)("inlineCode",{parentName:"p"},"RegisterDto")," instance into ",(0,i.kt)("inlineCode",{parentName:"p"},"register")," method."),(0,i.kt)("p",null,"First, we have to generate ",(0,i.kt)("inlineCode",{parentName:"p"},"RegisterDto")," class with command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"php artisan evo:make-dto RegisterDto name:string email:string password:string password_confirmation:string\n")),(0,i.kt)("p",null,"Then you will get ",(0,i.kt)("inlineCode",{parentName:"p"},"app/Dtos/RegisterDto.php")," file with code like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n\nnamespace App\\Dto;\n\nuse Emsifa\\Evo\\Dto;\n\nclass RegisterDto extends Dto\n{\n    public string $name;\n    public string $email;\n    public string $password;\n    public string $password_confirmation;\n}\n")),(0,i.kt)("p",null,"Now you may want to add some extra validations to each properties. You can do that by attaching rules attribute like an example below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php",metastring:"{6,10,13-15,18,19,22,23}","{6,10,13-15,18,19,22,23}":!0},'<?php\n\nnamespace App\\Dto;\n\nuse Emsifa\\Evo\\Dto;\nuse Emsifa\\Evo\\Rules;\n\nclass RegisterDto extends Dto\n{\n    #[Rules\\Required]\n    public string $name;\n\n    #[Rules\\Required]\n    #[Rules\\Email(message: "Incorrect email format")]\n    #[Rules\\Unique(table: \'users\', column: \'email\', message: "Email already used by someone")]\n    public string $email;\n\n    #[Rules\\Required]\n    #[Rules\\Min(6, message: "Password must have at least 6 characters")]\n    public string $password;\n\n    #[Rules\\Required]\n    #[Rules\\SameWith(\'password\', message: "Password confirmation doesn\'t match with password")]\n    public string $password_confirmation;\n}\n')),(0,i.kt)("p",null,"Behind the scene, code above will do validation like Laravel code below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"$request->validate([\n    'name' => 'required',\n    'email' => 'required|email|unique:users,email',\n    'password' => 'required|min:6',\n    'password_confirmation' => 'required|same:password',\n], [\n    'email.email' => \"Incorrect email format\",\n    'email.unique' => \"Email already used by someone\",\n    'password.min' => \"Password must have at least 6 characters\",\n    'password_confirmation.same' => \"Password confirmation doesn't match with password\",\n]);\n")),(0,i.kt)("p",null,"After defining validation rules to properties, you can inject ",(0,i.kt)("inlineCode",{parentName:"p"},"RegisterDto")," instance to your method like any other attributes before, but with ",(0,i.kt)("inlineCode",{parentName:"p"},"Body")," attribute."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php",metastring:"{2}","{2}":!0},"#[Post('register')]\npublic function register(#[Body] RegisterDto $dto)\n{\n    // ...\n}\n")),(0,i.kt)("p",null,"And there you go. Same like any other attributes. Evo will validate the values, resolving ",(0,i.kt)("inlineCode",{parentName:"p"},"RegisterDto")," instance, and inject it to ",(0,i.kt)("inlineCode",{parentName:"p"},"$dto")," parameter."),(0,i.kt)("h2",{id:"uploaded-file"},"Uploaded File"),(0,i.kt)("p",null,"You can get uploaded files in two ways below:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Using DTO class and ",(0,i.kt)("inlineCode",{parentName:"li"},"Body")," attribute."),(0,i.kt)("li",{parentName:"ol"},"Using ",(0,i.kt)("inlineCode",{parentName:"li"},"File")," attribute.")),(0,i.kt)("h3",{id:"1-getting-uploaded-file-using-dto-and-body-attribute"},"1. Getting uploaded file using DTO and ",(0,i.kt)("inlineCode",{parentName:"h3"},"Body")," attribute"),(0,i.kt)("p",null,"To get uploaded file using DTO, you can just add a property with type ",(0,i.kt)("inlineCode",{parentName:"p"},"Illuminate\\Http\\UploadedFile"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php",metastring:"{7,16}","{7,16}":!0},"<?php\n\nnamespace App\\Dto;\n\nuse Emsifa\\Evo\\Dto;\nuse Emsifa\\Evo\\Rules;\nuse Illuminate\\Http\\UploadedFile;\n\nclass UpdateProfileDto extends Dto\n{\n    #[Rules\\Required]\n    public string $name;\n\n    #[Rules\\Mimes(['jpeg', 'png'])]\n    #[Rules\\Image]\n    public ?UploadedFile $avatar = null;\n}\n")),(0,i.kt)("p",null,"In example above Evo will inject ",(0,i.kt)("inlineCode",{parentName:"p"},"$avatar")," property with ",(0,i.kt)("inlineCode",{parentName:"p"},"request()->file('avatar')")," value."),(0,i.kt)("h3",{id:"2-getting-uploaded-file-using-file-attribute"},"2. Getting uploaded file using ",(0,i.kt)("inlineCode",{parentName:"h3"},"File")," attribute"),(0,i.kt)("p",null,"If you want directly inject uploaded file instance to your controller method, you can use ",(0,i.kt)("inlineCode",{parentName:"p"},"File")," attribute like an example below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php",metastring:"{4}","{4}":!0},"#[Post('register')]\npublic function register(\n    #[Body] RegisterDto $dto,\n    #[File(rules: 'required|mimes:jpeg,png|image')] UploadedFile $avatar,\n)\n{\n    // ...\n}\n")),(0,i.kt)("h2",{id:"loggeduser-attribute"},(0,i.kt)("inlineCode",{parentName:"h2"},"LoggedUser")," Attribute"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"LoggedUser")," attribute is used to get current logged user instance from ",(0,i.kt)("inlineCode",{parentName:"p"},"request()->user()"),".\nYou can use it like any other request attributes before, just make sure if its optional, you have to make it nullable and set default value to null."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php",metastring:"{3}","{3}":!0},"public function show(\n    #[Param] int $id,\n    #[LoggedUser] ?User $user = null,\n)\n{\n    // ...\n}\n")),(0,i.kt)("h2",{id:"create-custom-request-attribute"},"Create Custom Request Attribute"),(0,i.kt)("p",null,"You can create your own request getter attribute by creating a class implementing ",(0,i.kt)("inlineCode",{parentName:"p"},"Emsifa\\Evo\\Contracts\\RequestGetter")," interface."),(0,i.kt)("p",null,"For example we will create ",(0,i.kt)("inlineCode",{parentName:"p"},"JwtToken")," attribute to retrieve JWT token from header or cookie."),(0,i.kt)("p",null,"First, create a file ",(0,i.kt)("inlineCode",{parentName:"p"},"app/Http/Attributes/JwtToken.php"),"."),(0,i.kt)("p",null,"Then you can use code below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},'<?php\n\nnamespace App\\Http\\Attributes;\n\nuse Attribute;\nuse Emsifa\\Evo\\Contracts\\RequestGetter;\nuse Illuminate\\Http\\Request;\nuse Illuminate\\Support\\Str;\nuse ReflectionParameter;\nuse ReflectionProperty;\n\n#[Attribute(Attribute::TARGET_PARAMETER)]\nclass JwtToken implements RequestGetter\n{\n    public function getRequestValue(Request $request, ReflectionParameter | ReflectionProperty $reflection): mixed\n    {\n        $token_from_header = $request->header("authorization");\n        $token_from_cookie = $request->cookie("token");\n\n        return $token_from_header\n            ? Str::after($token_from_header, "Bearer ")\n            : $token_from_cookie;\n    }\n}\n')),(0,i.kt)("p",null,"Now you can use it like any other request attributes like following code:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"public function doSomething(#[JwtToken] ?string $token = null)\n{\n    // ...\n}\n")),(0,i.kt)("p",null,"In most case you may want to validate the value to make sure it is safe for Evo to type cast it and inject it to your parameter.\nTo do that, you can implement ",(0,i.kt)("inlineCode",{parentName:"p"},"Emsifa\\Evo\\Contracts\\RequestValidator")," like an example below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php",metastring:"{7,10,15,27-38}","{7,10,15,27-38}":!0},'<?php\n\nnamespace App\\Http\\Attributes;\n\nuse Attribute;\nuse Emsifa\\Evo\\Contracts\\RequestGetter;\nuse Emsifa\\Evo\\Contracts\\RequestValidator;\nuse Illuminate\\Http\\Request;\nuse Illuminate\\Support\\Str;\nuse Illuminate\\Support\\Facades\\Validator;\nuse ReflectionParameter;\nuse ReflectionProperty;\n\n#[Attribute(Attribute::TARGET_PARAMETER)]\nclass JwtToken implements RequestGetter, RequestValidator\n{\n    public function getRequestValue(Request $request, ReflectionParameter | ReflectionProperty $reflection): mixed\n    {\n        $token_from_header = $request->header("authorization");\n        $token_from_cookie = $request->cookie("token");\n\n        return $token_from_header\n            ? Str::after($token_from_header, "Bearer ")\n            : $token_from_cookie;\n    }\n\n    public function validateRequest(Request $request, ReflectionProperty | ReflectionParameter $reflection)\n    {\n        $data = [\n            "token" => $this->getRequestValue($request, $reflection)\n        ];\n\n        $rules = [\n            "token" => "required|string",\n        ];\n\n        Validator::make($data, $rules)->validate();\n    }\n}\n')),(0,i.kt)("p",null,"Now Evo will run ",(0,i.kt)("inlineCode",{parentName:"p"},"validateRequest")," before type casting it's value and inject it to your parameter."))}c.isMDXComponent=!0}}]);